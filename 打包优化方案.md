# ğŸ¯ PyQt6 åº”ç”¨æ‰“åŒ…ä½“ç§¯ä¼˜åŒ–æ–¹æ¡ˆï¼ˆ2025-11 æ›´æ–°ï¼‰

## 1. é¡¹ç›®ç°çŠ¶é€Ÿè§ˆ

| é¡¹ç›®è¦ç´  | æœ€æ–°çŠ¶æ€ |
| --- | --- |
| å…¥å£è„šæœ¬ | `label_gui_qt.py`ï¼ˆä»…è´Ÿè´£å¯åŠ¨ & Splashï¼‰ |
| ä¸»è¦æ¨¡å— | `ui/`ï¼ˆç•Œé¢ + UIå¸¸é‡ï¼‰ã€`services/`ï¼ˆä¸šåŠ¡ + éªŒè¯ï¼‰ã€`config/`ï¼ˆé…ç½® + éªŒè¯å™¨ï¼‰ã€`i18n/`ã€`widgets/` |
| æ‰“åŒ…æ–¹å¼ | ç›®å½•æ¨¡å¼ï¼ˆ`COLLECT`ï¼‰ |
| ä¾èµ–ç»„ä»¶ | PyQt6ã€Pillowã€PyMuPDFã€reportlab |
| ä¾èµ–ç®¡ç† | `requirements.txt` |
| ç‰ˆæœ¬ç®¡ç† | `__version__.py` |

> **è¯´æ˜**ï¼šUI/ä¸šåŠ¡æ‹†åˆ†åï¼ŒPyInstaller ä¼šè‡ªåŠ¨æ”¶é›† Python åŒ…ï¼Œä½†ä»éœ€æ˜¾å¼æºå¸¦å›¾æ ‡ç­‰é™æ€èµ„æºï¼Œå¹¶é‡æ–°å®¡è§†éšè—å¯¼å…¥ / æ’é™¤é…ç½®ã€‚æœ€æ–°ä¼˜åŒ–åŒ…æ‹¬é…ç½®éªŒè¯ã€è¾“å…¥éªŒè¯ã€UI å¸¸é‡é›†ä¸­ç®¡ç†ç­‰ã€‚

### ä½“ç§¯æ„æˆå‚è€ƒ
```
PyQt6 æ ¸å¿ƒåº“     : ~120MB
PyMuPDF (fitz)   : ~40MB
Pillow + reportlab: ~25MB
Python è¿è¡Œæ—¶     : ~25MB
å…¶ä»–ä¾èµ– / DLL    : ~60MB
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»ä½“ç§¯           : ~270MB
```

## 2. ä¼˜åŒ–ç›®æ ‡

- **ç›®æ ‡ä½“ç§¯**ï¼š230-260MBï¼ˆåœ¨ä¿è¯åŠŸèƒ½çš„å‰æä¸‹ï¼Œæ”¶çª„æ³¢åŠ¨åŒºé—´ï¼‰
- **ç­–ç•¥æ¦‚è§ˆ**ï¼š
  1. æ’é™¤æœªä½¿ç”¨çš„æ ‡å‡†åº“ / PyQt6 å­æ¨¡å—
  2. ä¿ç•™ `ui`ã€`services` ç­‰è‡ªå®šä¹‰åŒ…
  3. å¯ç”¨ `optimize=2` ä¸ UPX å‹ç¼©ï¼ˆå¦‚æ— æ€è½¯è¯¯æŠ¥ï¼‰
  4. ä»…ä¿ç•™å¿…è¦éšè—å¯¼å…¥ï¼ˆPillowï¼‰

## 3. æ–°ç‰ˆ spec æ ¸å¿ƒé…ç½®

### 3.1 éœ€ä¿ç•™çš„æ•°æ®èµ„æº

```python
datas = [
    ('label.ico', '.'),
    ('label.png', '.'),
]
```

> å¦‚æœåç»­å¢åŠ è¯­è¨€åŒ… JSONã€æ¨¡æ¿æ–‡ä»¶ç­‰é™æ€èµ„æºï¼Œè¯·åŒæ­¥è¡¥å……åˆ° `datas`ã€‚

### 3.2 å»ºè®®çš„æ’é™¤æ¨¡å—

```python
excludes = [
    # æœªä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åº“
    'tkinter', 'matplotlib', 'numpy', 'pandas', 'scipy',
    'IPython', 'notebook', 'pytest', 'unittest', 'setuptools', 'distutils',
    # PyQt6 æœªä½¿ç”¨å­æ¨¡å—
    'PyQt6.QtWebEngine', 'PyQt6.QtWebEngineCore', 'PyQt6.QtWebEngineWidgets',
    'PyQt6.QtMultimedia', 'PyQt6.QtMultimediaWidgets',
    'PyQt6.Qt3D', 'PyQt6.QtQuick', 'PyQt6.QtQml',
    'PyQt6.QtBluetooth', 'PyQt6.QtNfc', 'PyQt6.QtPositioning', 'PyQt6.QtSensors',
    # å…¶ä»–ä¸éœ€è¦çš„æ ‡å‡†åº“
    'xml.etree', 'pydoc', 'doctest', '_pytest', 'test', 'tests',
]
```

### 3.3 éšè—å¯¼å…¥

```python
hiddenimports = [
    'PIL._tkinter_finder',
]
```

### 3.4 å…¶ä»–å…³é”®å‚æ•°

```python
optimize=2          # ç§»é™¤ docstring / assert
upx=True            # å¦‚è¢«è¯¯æŠ¥ï¼Œå¯è®¾ä¸º False
upx_exclude=[]
```

## 4. æ¨è spec æ¨¡æ¿ï¼ˆ`label_bundle.spec`ï¼‰

```python
# -*- mode: python ; coding: utf-8 -*-

block_cipher = None

datas = [
    ('label.ico', '.'),
    ('label.png', '.'),
]

hiddenimports = ['PIL._tkinter_finder']

excludes = [
    'tkinter', 'matplotlib', 'numpy', 'pandas', 'scipy',
    'IPython', 'notebook', 'pytest', 'unittest', 'setuptools', 'distutils',
    'PyQt6.QtWebEngine', 'PyQt6.QtWebEngineCore', 'PyQt6.QtWebEngineWidgets',
    'PyQt6.QtMultimedia', 'PyQt6.QtMultimediaWidgets',
    'PyQt6.Qt3D', 'PyQt6.QtQuick', 'PyQt6.QtQml',
    'PyQt6.QtBluetooth', 'PyQt6.QtNfc', 'PyQt6.QtPositioning', 'PyQt6.QtSensors',
    'xml.etree', 'pydoc', 'doctest', '_pytest', 'test', 'tests',
]

a = Analysis(
    ['label_gui_qt.py'],
    pathex=[],
    binaries=[],
    datas=datas,
    hiddenimports=hiddenimports,
    hookspath=[],
    hooksconfig={},
    runtime_hooks=[],
    excludes=excludes,
    win_no_prefer_redirects=False,
    win_private_assemblies=False,
    cipher=block_cipher,
    noarchive=False,
    optimize=2,
)

pyz = PYZ(a.pure, a.zipped_data, cipher=block_cipher)

exe = EXE(
    pyz,
    a.scripts,
    [],
    exclude_binaries=True,
    name='æ ‡ç­¾æ‰“å°å·¥å…·',
    debug=False,
    bootloader_ignore_signals=False,
    strip=False,
    upx=True,
    console=False,
    disable_windowed_traceback=False,
    argv_emulation=False,
    target_arch=None,
    codesign_identity=None,
    entitlements_file=None,
    icon=['label.ico'],
)

coll = COLLECT(
    exe,
    a.binaries,
    a.datas,
    strip=False,
    upx=True,
    upx_exclude=[],
    name='æ ‡ç­¾æ‰“å°å·¥å…·',
)
```

## 5. æ‰“åŒ…æ­¥éª¤

```bash
# 1. ï¼ˆå¯é€‰ï¼‰åˆ›å»ºå¹²å‡€çš„è™šæ‹Ÿç¯å¢ƒ
python -m venv venv_build
venv_build\Scripts\activate

# 2. å®‰è£…å¿…è¦ä¾èµ–ï¼ˆæ¨èä½¿ç”¨ requirements.txtï¼‰
pip install -U pip wheel
pip install -r requirements.txt
pip install pyinstaller

# æˆ–è€…æ‰‹åŠ¨å®‰è£…ä¾èµ–
# pip install PyQt6 Pillow PyMuPDF reportlab pyinstaller

# 3. ä½¿ç”¨ spec æ‰“åŒ…
pyinstaller label_bundle.spec

# 4. è¿›å…¥ dist/æ ‡ç­¾æ‰“å°å·¥å…· ç›®å½•ï¼Œå…¨é¢å›å½’æµ‹è¯•
```

## 6. é¢„æœŸæ”¶ç›Š

- âœ… ä¿æŒç°æœ‰æ¨¡å—åŒ–ç»“æ„ï¼ˆui / services / config ç­‰ï¼‰
- âœ… æ§åˆ¶ä½“ç§¯åœ¨ 230-260MB åŒºé—´
- âœ… å‡†å¤‡ UPX å¼€å…³ï¼Œå…¼é¡¾ä½“ç§¯ä¸å…¼å®¹æ€§
- âœ… æ–‡æ¡£ä¸å·¥ç¨‹ä¸€ä¸€å¯¹åº”ï¼Œå‡å°‘åç»­ç»´æŠ¤æˆæœ¬

## 7. å¸¸è§é—®é¢˜

| åœºæ™¯ | è§£å†³æ€è·¯ |
| --- | --- |
| å‡ºç°ç¼ºåŒ…æŠ¥é”™ | æ£€æŸ¥ `hiddenimports` æ˜¯å¦é—æ¼ï¼ˆå¦‚åç»­æ–°å¢æ–°åº“ï¼‰ã€‚ |
| å¯åŠ¨åç•Œé¢ç©ºç™½ | ç¡®è®¤ UI æ¨¡å—è·¯å¾„æ— è¯¯ï¼Œå¹¶ç¡®ä¿ `datas` ä¸­åŒ…å«å¿…è¦èµ„æºã€‚ |
| æ€æ¯’è½¯ä»¶è¯¯æŠ¥ | å…³é—­ `upx` æˆ–åœ¨ç»ˆç«¯æ‰§è¡Œ `set UPX=-` åé‡æ–°æ‰“åŒ…ã€‚ |
| è®¾ç½®æœªä¿å­˜ | ç¡®è®¤æ‰“åŒ…ç›®å½•å¯¹ `settings.json` å…·å¤‡å†™æƒé™ï¼Œæˆ–åœ¨é€»è¾‘ä¸­å®šä½é…ç½®è·¯å¾„ã€‚ |

## 8. åç»­ç»´æŠ¤å»ºè®®

1. **ä»£ç è´¨é‡**ï¼šé¡¹ç›®å·²å®æ–½é…ç½®éªŒè¯ã€è¾“å…¥éªŒè¯ã€UI å¸¸é‡é›†ä¸­ç®¡ç†ç­‰ä¼˜åŒ–ï¼Œæ–°å¢åŠŸèƒ½æ—¶è¯·ä¿æŒè¿™äº›è§„èŒƒã€‚
2. **ä¾èµ–ç®¡ç†**ï¼šä½¿ç”¨ `requirements.txt` ç®¡ç†ä¾èµ–ç‰ˆæœ¬ï¼Œæ›´æ–°ä¾èµ–æ—¶åŒæ­¥æ›´æ–°æ­¤æ–‡ä»¶ã€‚
3. **ç‰ˆæœ¬ç®¡ç†**ï¼šåœ¨ `__version__.py` ä¸­ç»´æŠ¤ç‰ˆæœ¬å·ï¼Œå‘å¸ƒæ–°ç‰ˆæœ¬æ—¶è®°å¾—æ›´æ–°ã€‚
4. **é™æ€èµ„æº**ï¼šæ–°å¢é™æ€èµ„æºï¼ˆå­—ä½“ã€æ¨¡æ¿ç­‰ï¼‰æ—¶ï¼ŒåŒæ­¥æ›´æ–° `datas`ï¼Œå¹¶åœ¨æ–‡æ¡£ä¸­ç™»è®°ã€‚
5. **æ‰“åŒ…éªŒè¯**ï¼šä¸šåŠ¡æ‹†åˆ†åï¼Œæ–°å¢æ¨¡å—æ—¶å…ˆåœ¨å¼€å‘ç¯å¢ƒè¿è¡Œ `pyinstaller --clean label_bundle.spec` éªŒè¯ç¼ºå°‘ä¾èµ–ã€‚
6. **æ–‡æ¡£åŒæ­¥**ï¼šå°† `label_bundle.spec` ä¸ `æ‰“åŒ…ä¼˜åŒ–æ–¹æ¡ˆ.md` ä¸€èµ·éšä»£ç ç‰ˆæœ¬è¿­ä»£ï¼Œä¿æŒä¸€è‡´ã€‚

---

**æœ€åæ›´æ–°**ï¼š2025-11-19

**é€‚ç”¨ç‰ˆæœ¬**ï¼šå½“å‰ä¸»å¹²ï¼ˆæ¨¡å—åŒ– UI + Services + ä»£ç è´¨é‡ä¼˜åŒ–ï¼‰

**ç»´æŠ¤äºº**ï¼šCW